<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAKA RTO App</title>

<link rel="stylesheet" href="styles.css"> 
<script src="app.js"></script>

<style>
/* Masalah Styling Tetap Terjadi. Kita Tambahkan Kode CSS INTINYA Disini */
/* Agar tampilannya pasti Putih dan Grid Kalender muncul. */

:root {
  --bg-main: #f5f6f8; --card-bg: rgba(255, 255, 255, 0.95); --glass-border: rgba(0, 0, 0, 0.1); 
  --primary-neon: #007aff; --paid-green: #00a049; --holiday-color: #e63946; 
  --dp-color: #8e44ad; --text-main: #222; --text-secondary: #7f8c8d;
}

body { background: var(--bg-main); color: var(--text-main); padding-bottom: 90px; font-family: "Inter", system-ui, sans-serif;}
.app-container { max-width: 420px; margin: auto; padding-bottom: 130px; }
.card { background: var(--card-bg); border-radius: 18px; padding: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); margin-bottom: 20px; border: 1px solid var(--glass-border); }
.login-screen { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; background: var(--bg-main);}
.login-screen .card { width: 100%; max-width: 350px;}

.hero-tunggakan {
  margin-top: 18px; background: var(--card-bg); border-radius: 18px; padding: 16px;
  display: flex; justify-content: space-between; align-items: center;
  box-shadow: 0 8px 20px rgba(0,0,0,.1); border: 1px solid var(--glass-border);
}
.icon-grid-section { padding: 0 20px; }
.icon-grid-section h3 { color: var(--primary-neon); font-size: 1.1em; margin-bottom: 15px;}
.icon-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 14px;}

/* KALENDER GRID FIX */
.cal-header { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; padding: 10px 14px 0; font-size: 0.7em; font-weight: 600; color: var(--text-secondary);}
.cal-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:8px; padding:14px;}
.day-box {
  border-radius:12px; padding:10px 0; font-size:.7em; text-align:center;
  border:1px solid var(--glass-border); background:var(--card-bg);
  box-shadow: 0 2px 5px rgba(0,0,0,.05);
}
.paid-day { background: #d4edda; color: #155724; font-weight: 700; border-color: #c3e6cb;} 
.dp-day { background: #d6b8ef; color: #4f3366; font-weight: 700; border-color: #c0a8d7;}
.holiday-day { background: #f8d7da; color: #721c24; opacity: 1; border-color: #f5c6cb;}
.bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 82px; display: flex; justify-content: space-around; align-items: center; background: rgba(255,255,255,.98); backdrop-filter: blur(16px); border-top: 1px solid rgba(0,0,0,.08); z-index: 999; box-shadow: 0 -4px 15px rgba(0,0,0,.08);}
</style>
</head>
<body>

<div id="loginScreen" class="login-screen">
  <div class="card">
    <h1>Login MAKA RTO</h1>
    <label>Nama User</label><input id="nama" type="text" placeholder="Nama lengkap">
    <label>Plat Nomor</label><input id="plat" type="text" placeholder="B 1234 ABC">
    <label>Tanggal Ambil Motor</label><input id="tanggalAmbil" type="date">
    <label>Opsi DP</label>
    <select id="dp">
      <option value="355">DP 355.000 (Cicil)</option>
      <option value="755">DP 755.000 (Langsung)</option>
    </select>
    <button onclick="callLoginFunction()">MASUK</button>
  </div>
</div>

<div id="dashboardScreen" class="app-container" style="display: none;">
  <header class="header">
    <div class="user-info">
      <h1 id="userName">Halo</h1>
      <p>Plat Motor <b id="userPlate"></b></p>
    </div>
    <div class="hero-tunggakan">
      <div><h3>JUMLAH TUNGGAKAN</h3><p class="hero-sub" id="tunggakanDays">0 Hari</p></div>
      <div class="hero-tunggakan-value"><span id="billTotal">Rp 0</span></div>
    </div>
    <div class="futuristic-divider"></div>
    <div class="progress-box">
      <div class="progress-label"><span>Progress RTO</span><span id="progressText">0 / 1009 Hari</span></div>
      <div class="progress-bar"><div id="progressBarFill"></div></div>
    </div>
  </header>
  <section class="icon-grid-section">
    <h3 class="section-title">‚ú® Fitur</h3>
    <div class="icon-grid">
      <a href="#" class="icon-item" onclick="showScreen('calendar')"><span>üìÖ</span><p>Kalender</p></a>
      <a href="#" class="icon-item" onclick="showScreen('history')"><span>üßæ</span><p>Riwayat</p></a>
      <a href="#" class="icon-item" onclick="showScreen('parts')"><span>üéÅ</span><p>Part Gratis</p></a>
      <a href="#" class="icon-item" onclick="showScreen('mlu')"><span>üì∞</span><p>Info MLU</p></a>
      <a href="#" class="icon-item" onclick="showScreen('tips')"><span>üí°</span><p>Maka Tips</p></a>
      <a href="#" class="icon-item"><span>‚≠ê</span><p>MAKA+</p></a>
      <a href="#" class="icon-item" onclick="showScreen('settings')"><span>‚öôÔ∏è</span><p>Setting</p></a>
      <a href="https://wa.me/62812XXXXXXX" target="_blank" class="icon-item sos-card"><span>üö®</span><p>SOS CS</p></a>
    </div>
  </section>
</div>

<div id="calendarScreen" class="app-container" style="display: none;">
    <h3 class="header-title" style="padding: 22px 22px 0;">üìÖ Kalender Pembayaran</h3>
    <div class="cal-header">
        <span style="color: var(--holiday-color);">Min</span><span>Sen</span><span>Sel</span><span>Rab</span>
        <span>Kam</span><span>Jum</span><span>Sab</span>
    </div>
    <div class="cal-grid" id="calendar"></div>
</div>

<div id="historyScreen" class="app-container" style="display: none;">
    <h3 class="header-title" style="padding: 22px 22px 0;">üßæ Riwayat Pembayaran</h3>
    <div class="card">
        <p style="font-weight: 600; font-size: 0.9em; margin-bottom: 10px;">Log Transaksi</p>
        <ul id="paymentHistoryList" style="list-style: none; padding: 0;"></ul>
    </div>
</div>

<div id="partsScreen" class="app-container" style="display: none;">
    <h3 class="header-title" style="padding: 22px 22px 0;">üéÅ Part Gratis</h3>
    <div id="partsContent"></div>
</div>

<div id="settingsScreen" class="app-container" style="display: none;">
    <h3 class="header-title" style="padding: 22px 22px 0;">‚öôÔ∏è Setting & Pause</h3>
    <div class="card">
        <h4>User Profile</h4>
        <label>Nama</label><input type="text" id="settingNama" readonly>
        <label>Plat Nomor</label><input type="text" id="settingPlat" readonly>
        <label>No HP Baru</label><input type="tel" id="settingNoHp" placeholder="Masukkan nomor HP baru">
        <button onclick="updateSettings()">Ganti No HP</button>
        <div class="futuristic-divider"></div>
        <h4>PAUSE Pembayaran</h4>
        <p style="font-size: 0.8em; color: var(--holiday-color); margin-bottom: 10px;">Pause pembayaran akan memperpanjang total 1009 hari sewa Anda.</p>
        <label>Alasan Pause</label><select id="pauseReason"><option value="">-- Pilih Alasan --</option><option value="Sakit">Sakit</option><option value="Kecelakaan">Kecelakaan</option><option value="Lainnya">Lainnya</option></select>
        <label>Durasi Pause (Hari)</label><input type="number" id="pauseDuration" placeholder="Contoh: 7" min="1">
        <button onclick="requestPause()">Ajukan Pause</button>
        <p id="pauseStatus" style="font-size: 0.8em; margin-top: 10px;"></p>
    </div>
</div>


<footer id="bottomNav" class="bottom-nav" style="display: none;">
  <a href="#" class="nav-item" onclick="showScreen('fc')"><span>‚ö°</span>FC</a>
  <a href="#" class="nav-item active" id="navHome" onclick="showScreen('dashboard')"><span>üè†</span>Home</a>
  <a href="#" class="nav-item" id="navCalendar" onclick="showScreen('calendar')"><span>üìÖ</span>Bayar</a>
</footer>

<script>
/* FIX: Wrapper function untuk memanggil loginUser() dari app.js */
function callLoginFunction() {
    // Fungsi ini akan dieksekusi saat tombol MASUK diklik
    if (typeof loginUser === 'function') {
        loginUser();
    } else {
        alert("Error: Logic aplikasi (app.js) belum termuat dengan benar. Cek console browser.");
    }
}

// --- FUNGSI LAIN (showScreen, renderDashboard, renderCalendar, dsb) ---
// ... (Salin semua fungsi dari script tag di jawaban sebelumnya di sini) ...

// **PENTING:** Anda harus menyalin SEMUA fungsi JS yang lain (showScreen, renderDashboard, renderCalendar, renderParts, dll.) di sini! 
// Saya tidak menyalinnya untuk menghemat ruang, tapi pastikan semua fungsi yang ada di <script> di jawaban sebelumnya, disalin dan ditempel di sini.

// --- INITIAL CHECK ---
document.addEventListener('DOMContentLoaded', () => {
    // Memastikan app.js sudah dimuat sebelum menjalankan ini
    if (typeof getActiveUser === 'function') {
        const user = getActiveUser();
        if (user && user.id) {
            showScreen('dashboard');
        } else {
            showScreen('login');
        }
    }
});
</script>

</body>
</html>
