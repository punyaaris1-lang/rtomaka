<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAKA RTO App</title>

<link rel="stylesheet" href="styles.css"> 
<script src="app.js"></script>

<style>
/* ========================================= */
/* CSS FIX (UNTUK MEMASTIKAN TAMPILAN MUNCUL) */
/* ========================================= */
:root {
  /* Variabel Utama (Tema Putih) */
  --bg-main: #f5f6f8; 
  --card-bg: rgba(255, 255, 255, 0.95); 
  --glass-border: rgba(0, 0, 0, 0.1); 
  --primary-neon: #007aff; 
  --paid-green: #00a049; 
  --holiday-color: #e63946; 
  --dp-color: #8e44ad; 
  --text-main: #222;
  --text-secondary: #7f8c8d;
}

body {
  background: var(--bg-main); 
  color: var(--text-main);
  padding-bottom: 90px;
  font-family: "Inter", system-ui, sans-serif;
}

.app-container { max-width: 420px; margin: auto; padding-bottom: 130px; }
.card { background: var(--card-bg); border-radius: 18px; padding: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); margin-bottom: 20px; border: 1px solid var(--glass-border); }

/* DASHBOARD LAYOUT FIX */
.header { padding: 22px; }
.hero-tunggakan {
  margin-top: 18px; background: var(--card-bg); border-radius: 18px; padding: 16px;
  display: flex; justify-content: space-between; align-items: center;
  box-shadow: 0 8px 20px rgba(0,0,0,.1); border: 1px solid var(--glass-border);
}
.hero-tunggakan h3 { font-size: .75em; color: var(--primary-neon); margin: 0;}
.hero-tunggakan-value span { font-size: 1.35em; font-weight: 700;}
.futuristic-divider { height: 1px; margin: 22px 0; background: var(--glass-border); opacity: 1;}
.progress-box { margin: 18px 0;}
.progress-label { display: flex; justify-content: space-between; font-size: 0.8em; margin-bottom: 8px; color: var(--text-secondary);}
.progress-bar { width: 100%; height: 10px; background: #e9ecef; border-radius: 10px; overflow: hidden;}
#progressBarFill { height: 100%; background: var(--primary-neon); width: 0%; border-radius: 10px; transition: width 0.3s ease;}
.icon-grid-section { padding: 0 20px; }
.icon-grid-section h3 { color: var(--primary-neon); font-size: 1.1em; margin-bottom: 15px;}
.icon-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 14px;}
.icon-item {
  background: var(--card-bg); border-radius: 16px; padding: 16px 10px; text-align: center;
  border: 1px solid var(--glass-border); color: var(--text-main); text-decoration: none;
  box-shadow: 0 4px 10px rgba(0,0,0,.05); transition: transform .2s ease;
}
.icon-item span { display: block; font-size: 1.7em; margin-bottom: 6px;}
.icon-item p { margin: 0; font-size: .72em; font-weight: 600; color: var(--text-secondary);}

/* KALENDER GRID FIX */
.cal-header {
    display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; padding: 10px 14px 0;
    font-size: 0.7em; font-weight: 600; color: var(--text-secondary);
}
.cal-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:8px; padding:14px;}
.day-box {
  border-radius:12px; padding:10px 0; font-size:.7em; text-align:center;
  border:1px solid var(--glass-border); background:var(--card-bg);
  box-shadow: 0 2px 5px rgba(0,0,0,.05);
}
.day-box b{ display:block; font-size:1.1em; font-weight:700;}

/* STATUS COLORS */
.paid-day { background: #d4edda; color: #155724; font-weight: 700; border-color: #c3e6cb;} 
.dp-day { background: #d6b8ef; color: #4f3366; font-weight: 700; border-color: #c0a8d7;}
.holiday-day { background: #f8d7da; color: #721c24; opacity: 1; border-color: #f5c6cb;}
.today-day{ outline:2px solid var(--primary-neon); box-shadow: 0 0 10px rgba(0,122,255,.3);}

/* BOTTOM NAV FIX */
.bottom-nav {
  position: fixed; bottom: 0; left: 0; right: 0; height: 82px; padding-bottom: env(safe-area-inset-bottom);
  display: flex; justify-content: space-around; align-items: center;
  background: rgba(255,255,255,.98); backdrop-filter: blur(16px);
  border-top: 1px solid rgba(0,0,0,.08); z-index: 999; box-shadow: 0 -4px 15px rgba(0,0,0,.08);
}
.nav-item {
  flex: 1; text-align: center; color: #7f8c8d; text-decoration: none; font-size: 12px;
  display: flex; flex-direction: column; gap: 6px; align-items: center; justify-content: center;
  transition: transform .2s ease;
}
.nav-item span { font-size: 28px;}
.nav-item.active { color: var(--primary-neon);}
.nav-item.active span {
  background: var(--primary-neon); color: #fff; width: 54px; height: 54px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center; transform: translateY(-22px);
  box-shadow: 0 0 20px rgba(0,122,255,.5);
}

</style>
</head>
<body>

<div id="loginScreen" class="login-screen">
  <div class="card">
    <h1>Login MAKA RTO</h1>
    <label>Nama User</label><input id="nama" type="text" placeholder="Nama lengkap">
    <label>Plat Nomor</label><input id="plat" type="text" placeholder="B 1234 ABC">
    <label>Tanggal Ambil Motor</label><input id="tanggalAmbil" type="date">
    <label>Opsi DP</label>
    <select id="dp">
      <option value="355">DP 355.000 (Cicil)</option>
      <option value="755">DP 755.000 (Langsung)</option>
    </select>
    <button onclick="loginUser()">MASUK</button>
  </div>
</div>

<div id="dashboardScreen" class="app-container" style="display: none;">
  <header class="header">
    <div class="user-info">
      <h1 id="userName">Halo</h1>
      <p>Plat Motor <b id="userPlate"></b></p>
    </div>

    <div class="hero-tunggakan">
      <div>
        <h3>JUMLAH TUNGGAKAN</h3>
        <p class="hero-sub" id="tunggakanDays">0 Hari</p>
      </div>
      <div class="hero-tunggakan-value">
        <span id="billTotal">Rp 0</span>
      </div>
    </div>

    <div class="futuristic-divider"></div>

    <div class="progress-box">
      <div class="progress-label">
        <span id="progressLabel">Progress RTO</span>
        <span id="progressText">0 / 1009 Hari</span>
      </div>
      <div class="progress-bar">
        <div id="progressBarFill"></div>
      </div>
    </div>
  </header>

  <section class="icon-grid-section">
    <h3 class="section-title">‚ú® Fitur</h3>
    <div class="icon-grid">
      <a href="#" class="icon-item" onclick="showScreen('calendar')"><span>üìÖ</span><p>Kalender</p></a>
      <a href="#" class="icon-item" onclick="showScreen('history')"><span>üßæ</span><p>Riwayat</p></a>
      <a href="#" class="icon-item" onclick="showScreen('parts')"><span>üéÅ</span><p>Part Gratis</p></a>
      <a href="#" class="icon-item" onclick="showScreen('mlu')"><span>üì∞</span><p>Info MLU</p></a>
      <a href="#" class="icon-item" onclick="showScreen('tips')"><span>üí°</span><p>Maka Tips</p></a>
      <a href="#" class="icon-item"><span>‚≠ê</span><p>MAKA+</p></a>
      <a href="#" class="icon-item" onclick="showScreen('settings')"><span>‚öôÔ∏è</span><p>Setting</p></a>
      <a href="https://wa.me/62812XXXXXXX" target="_blank" class="icon-item sos-card"><span>üö®</span><p>SOS CS</p></a>
    </div>
  </section>
</div>

<div id="calendarScreen" class="app-container" style="display: none;">
    <h3 class="header-title" style="padding: 22px 22px 0;">üìÖ Kalender Pembayaran</h3>
    <div class="cal-header">
        <span style="color: var(--holiday-color);">Min</span>
        <span>Sen</span>
        <span>Sel</span>
        <span>Rab</span>
        <span>Kam</span>
        <span>Jum</span>
        <span>Sab</span>
    </div>
    <div class="cal-grid" id="calendar"></div>
</div>

<div id="historyScreen" class="app-container" style="display: none;">
    <h3 class="header-title" style="padding: 22px 22px 0;">üßæ Riwayat Pembayaran</h3>
    <div class="card">
        <p style="font-weight: 600; font-size: 0.9em; margin-bottom: 10px;">Log Transaksi</p>
        <ul id="paymentHistoryList" style="list-style: none; padding: 0;"></ul>
    </div>
</div>

<div id="partsScreen" class="app-container" style="display: none;">
    <h3 class="header-title" style="padding: 22px 22px 0;">üéÅ Part Gratis</h3>
    <div id="partsContent"></div>
</div>

<div id="settingsScreen" class="app-container" style="display: none;">
    <h3 class="header-title" style="padding: 22px 22px 0;">‚öôÔ∏è Setting & Pause</h3>
    <div class="card">
        <h4>User Profile</h4>
        <label>Nama</label><input type="text" id="settingNama" readonly>
        <label>Plat Nomor</label><input type="text" id="settingPlat" readonly>
        <label>No HP Baru</label><input type="tel" id="settingNoHp" placeholder="Masukkan nomor HP baru">
        <button onclick="updateSettings()">Ganti No HP</button>

        <div class="futuristic-divider"></div>

        <h4>PAUSE Pembayaran</h4>
        <p style="font-size: 0.8em; color: var(--holiday-color); margin-bottom: 10px;">Pause pembayaran akan memperpanjang total 1009 hari sewa Anda.</p>
        <label>Alasan Pause (Sakit/Kecelakaan dll)</label>
        <select id="pauseReason">
            <option value="">-- Pilih Alasan --</option>
            <option value="Sakit">Sakit</option>
            <option value="Kecelakaan">Kecelakaan</option>
            <option value="Lainnya">Lainnya</option>
        </select>
        <label>Durasi Pause (Hari)</label>
        <input type="number" id="pauseDuration" placeholder="Contoh: 7" min="1">
        <button onclick="requestPause()">Ajukan Pause</button>
        <p id="pauseStatus" style="font-size: 0.8em; margin-top: 10px;"></p>
    </div>
</div>


<footer id="bottomNav" class="bottom-nav" style="display: none;">
  <a href="#" class="nav-item" onclick="showScreen('fc')"><span>‚ö°</span>FC</a>
  <a href="#" class="nav-item active" id="navHome" onclick="showScreen('dashboard')"><span>üè†</span>Home</a>
  <a href="#" class="nav-item" id="navCalendar" onclick="showScreen('calendar')"><span>üìÖ</span>Bayar</a>
</footer>

<script>

// --- Fungsi Global (showScreen, loginUser, dsb) sama seperti sebelumnya ---

function showScreen(screenId) {
    const screens = ['loginScreen', 'dashboardScreen', 'calendarScreen', 'historyScreen', 'partsScreen', 'settingsScreen', 'mluScreen', 'tipsScreen'];
    screens.forEach(id => {
        const element = document.getElementById(id);
        if(element) element.style.display = (id === screenId + 'Screen' || (id === 'loginScreen' && screenId === 'login')) ? 'block' : 'none';
    });

    const user = getActiveUser();
    document.getElementById('bottomNav').style.display = (user && screenId !== 'login') ? 'flex' : 'none';
    
    const navItems = document.querySelectorAll('.bottom-nav .nav-item');
    navItems.forEach(item => item.classList.remove('active'));
    
    if (screenId === 'dashboard') {
        document.getElementById('navHome').classList.add('active');
        renderDashboard();
    } else if (screenId === 'calendar') {
        document.getElementById('navCalendar').classList.add('active');
        renderCalendar(); 
    } else if (screenId === 'history') {
        renderHistory();
    } else if (screenId === 'parts') {
        renderParts(); 
    } else if (screenId === 'settings') {
        renderSettings(); 
    }
}

// ... (Fungsi loginUser() tetap sama) ...

// --- FUNGSI BARU: PART GRATIS ---
function renderParts() {
    const user = getActiveUser();
    const content = document.getElementById('partsContent');
    content.innerHTML = '';

    const parts = [
        { name: 'Ban Depan', kuota: user.freeParts.ban_depan_sisa || 3, total: 3, key: 'ban_depan' },
        { name: 'Ban Belakang', kuota: user.freeParts.ban_belakang_sisa || 3, total: 3, key: 'ban_belakang' },
        { name: 'Kampas Rem Depan', kuota: user.freeParts.kampas_rem_depan_sisa || 9, total: 9, key: 'kampas_rem_depan' },
        { name: 'Kampas Rem Belakang', kuota: user.freeParts.kampas_rem_belakang_sisa || 9, total: 9, key: 'kampas_rem_belakang' }
    ];

    parts.forEach(part => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
            <h4>${part.name}</h4>
            <p style="font-size: 0.8em; margin: 5px 0 10px;">Kuota Tahunan: ${part.total/3}</p>
            <div class="progress-label">
                <span>Sisa Kuota:</span>
                <span>${part.kuota} / ${part.total} Kali</span>
            </div>
            <div class="progress-bar" style="height: 6px;">
                <div style="height: 100%; background: var(--paid-green); width: ${(part.kuota / part.total) * 100}%; border-radius: 6px;"></div>
            </div>
            <button onclick="markPartUsed('${part.key}')" style="margin-top: 15px; background: #3498db; font-size: 0.9em; padding: 8px;">Gunakan Part</button>
        `;
        content.appendChild(card);
    });
}

function markPartUsed(key) {
    const user = getActiveUser();
    if (user.freeParts[key + '_sisa'] === undefined) {
        // Inisialisasi jika belum ada di data user
        user.freeParts[key + '_sisa'] = key.includes('ban') ? 3 : 9;
    }

    if (user.freeParts[key + '_sisa'] > 0) {
        if (confirm(`Yakin ingin menandai 1x penggunaan ${key.replace(/_/g, ' ').toUpperCase()}? Kuota akan berkurang.`)) {
            user.freeParts[key + '_sisa']--;
            // Catat log penggunaan (opsional)
            saveDB(DB);
            renderParts();
            alert('Penggunaan dicatat. Kuota diperbarui!');
        }
    } else {
        alert('Kuota gratis untuk part ini sudah habis.');
    }
}

// --- FUNGSI BARU: SETTINGS & PAUSE ---
function renderSettings() {
    const user = getActiveUser();
    document.getElementById('settingNama').value = user.nama;
    document.getElementById('settingPlat').value = user.plat;
    document.getElementById('settingNoHp').value = user.noHp || ''; 
    
    // Status Pause
    const statusText = user.pauseStatus?.isPaused ? 
        `‚è∏Ô∏è PAUSE AKTIF. Durasi: ${user.pauseStatus.duration} hari (Mundur ${user.pauseStatus.duration} hari).` :
        '‚ñ∂Ô∏è Tidak ada pause pembayaran aktif.';
    document.getElementById('pauseStatus').textContent = statusText;
}

function updateSettings() {
    const user = getActiveUser();
    const newHp = document.getElementById('settingNoHp').value.trim();

    user.noHp = newHp;
    saveDB(DB);
    alert('Nomor HP berhasil diperbarui.');
    renderDashboard();
}

function requestPause() {
    const user = getActiveUser();
    const reason = document.getElementById('pauseReason').value;
    const duration = parseInt(document.getElementById('pauseDuration').value);

    if (!reason || isNaN(duration) || duration <= 0) {
        alert('Mohon lengkapi alasan dan durasi pause yang valid.');
        return;
    }

    if (confirm(`Ajukan pause selama ${duration} hari dengan alasan: ${reason}? Total hari sewa akan mundur.`)) {
        // Logika Pause: Simpan status pause ke data user
        user.pauseStatus = {
            isPaused: true,
            reason: reason,
            duration: duration,
            requestedAt: new Date().toISOString()
        };
        // Catatan: Logic mundurnya tanggal akhir 1009 hari akan dihitung saat progress bar
        
        saveDB(DB);
        renderSettings();
        alert('Pengajuan Pause dicatat! Total hari RTO Anda akan mundur.');
    }
}

// ... (Fungsi renderDashboard, renderCalendar, renderHistory tetap sama) ...

// --- INITIAL CHECK ---
document.addEventListener('DOMContentLoaded', () => {
    const user = getActiveUser();
    if (user) {
        renderDashboard();
        showScreen('dashboard');
    } else {
        showScreen('login');
    }
});
</script>

</body>
</html>
