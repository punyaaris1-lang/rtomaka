<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maka Motor RTO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: sans-serif; }
        .app-container { max-width: 480px; margin: 0 auto; background: white; min-height: 100vh; padding: 20px; }
        .hidden { display: none; }
        .card-menu { text-align: center; padding: 15px; border-radius: 10px; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .card-menu i { font-size: 24px; color: #d32f2f; margin-bottom: 5px; display: block; }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body>

<div class="app-container">
    
    <div id="login-page">
        <h3 class="text-center mb-4 text-danger fw-bold">MAKA MOTOR</h3>
        <div class="card p-3 shadow-sm">
            <h5 class="mb-3">Login User</h5>
            <input type="email" id="email" class="form-control mb-2" placeholder="Email">
            <input type="password" id="password" class="form-control mb-3" placeholder="Password">
            <button onclick="login()" class="btn btn-danger w-100">MASUK</button>
            <p class="mt-3 text-center text-muted">Belum punya akun? Hubungi Admin.</p>
        </div>
    </div>

    <div id="dashboard-page" class="hidden">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h5 class="fw-bold m-0" id="user-name">Loading...</h5>
                <small class="text-muted" id="user-plat">...</small>
            </div>
            <button onclick="logout()" class="btn btn-sm btn-outline-secondary">Keluar</button>
        </div>

        <div class="alert alert-warning d-flex justify-content-between align-items-center">
            <span>Tunggakan:</span>
            <span class="fw-bold text-danger fs-5">Rp 0</span>
        </div>

        <small>Progress Sewa (Hari ke-50 dari 1009)</small>
        <div class="progress mb-4" style="height: 10px;">
            <div class="progress-bar bg-danger" role="progressbar" style="width: 5%"></div>
        </div>

        <div class="row">
            <div class="col-4">
                <div class="card-menu">
                    <i class="bi bi-calendar-check"></i>
                    <small>Kalender</small>
                </div>
            </div>
            <div class="col-4">
                <div class="card-menu">
                    <i class="bi bi-receipt"></i>
                    <small>Riwayat</small>
                </div>
            </div>
            <div class="col-4">
                <div class="card-menu">
                    <i class="bi bi-gear"></i>
                    <small>Setting</small>
                </div>
            </div>
            <div class="col-4">
                <div class="card-menu">
                    <i class="bi bi-tools"></i>
                    <small>Part Gratis</small>
                </div>
            </div>
            <div class="col-4">
                <div class="card-menu">
                    <i class="bi bi-info-circle"></i>
                    <small>Info MLU</small>
                </div>
            </div>
            <div class="col-4">
                <div class="card-menu">
                    <i class="bi bi-life-preserver"></i>
                    <small>SOS</small>
                </div>
            </div>
        </div>
    </div>

</div>

<script type="module">
    // 1. Konfigurasi Firebase (Tanpa Install!)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAk3G5aQUBVe_g7_peVu1F6xllP_RejGq0",
      authDomain: "rtomaka-e67b5.firebaseapp.com",
      projectId: "rtomaka-e67b5",
      storageBucket: "rtomaka-e67b5.firebasestorage.app",
      messagingSenderId: "472036722228",
      appId: "1:472036722228:web:11d520f9204db317d02c61"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // 2. Fungsi Login
    window.login = async () => {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        try {
            await signInWithEmailAndPassword(auth, email, pass);
            // Tidak perlu redirect, listener auth akan menangani
        } catch (error) {
            alert("Login Gagal: " + error.message);
        }
    }

    // 3. Fungsi Logout
    window.logout = () => signOut(auth);

    // 4. Cek Status Login (Otomatis pindah halaman)
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            // Jika user login
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('dashboard-page').classList.remove('hidden');
            
            // Ambil data nama & plat dari database
            try {
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    const data = userDoc.data();
                    document.getElementById('user-name').innerText = data.nama || "User";
                    document.getElementById('user-plat').innerText = data.plat_nomer || "Tanpa Plat";
                }
            } catch (e) {
                console.log("Error ambil data:", e);
            }

        } else {
            // Jika user logout
            document.getElementById('login-page').classList.remove('hidden');
            document.getElementById('dashboard-page').classList.add('hidden');
        }
    });
</script>

</body>
</html>
