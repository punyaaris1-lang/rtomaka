
<!doctype html>
<html lang="id">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>MAKA Dashboard</title><link rel="stylesheet" href="styles.css"/></head>
<body>
<div class="app-container">
  <header class="header">
    <a href="admin_login.html" style="position:absolute;top:12px;right:16px;font-size:.8rem;color:#7f8c9a">ADMIN</a>
    <div class="user-info">
      <h1 id="user-name-display">Halo, User</h1>
      <p>Plat Motor <strong id="user-plate-display">-</strong></p>
    </div>
    <div class="hero-tunggakan">
      <div>
        <h3>STATUS PEMBAYARAN</h3>
        <p>Perhitungan hingga hari ini</p>
      </div>
      <div class="hero-tunggakan-value">
        <span id="hero-tunggakan-nominal">Rp 0</span>
        <small id="hero-tunggakan-days">0 Hari</small>
      </div>
    </div>
  </header>

  <section class="icon-grid-section">
    <h2>âœ¨ Fitur Premium</h2>
    <div class="icon-grid">
      <a href="calendar.html" class="icon-item"><span>ğŸ“…</span><p>Bayar & Kalender</p></a>
      <a href="history.html" class="icon-item"><span>ğŸ—’ï¸</span><p>Riwayat</p></a>
      <a href="part_tracker.html" class="icon-item"><span>ğŸ</span><p>Gratisan</p></a>
      <a href="info_mlu.html" class="icon-item"><span>ğŸ“°</span><p>Info MLU</p></a>
      <a href="tips_maka.html" class="icon-item"><span>ğŸ’¡</span><p>Tips MAKA</p></a>
      <a href="#" class="icon-item" onclick="window.open('https://etle-pmj.info','_blank')"><span>ğŸš¨</span><p>Cek ETLE</p></a>
      <a href="settings.html" class="icon-item"><span>âš™ï¸</span><p>Pengaturan</p></a>
      <a href="maka_plus.html" class="icon-item" id="maka-plus-card"><span>â­</span><p>MAKA+</p></a>
      <a href="https://wa.me/62812XXXXXXXX?text=SOS%20MAKA%20DARURAT" target="_blank" class="icon-item sos-card"><span>ğŸš¨</span><p>SOS Darurat</p></a>
    </div>
  </section>

  <footer class="bottom-nav">
    <a href="lokasi_fc.html" class="nav-item"><span>âš¡</span>FC</a>
    <a href="dashboard.html" class="nav-item active"><span>ğŸ </span>Home</a>
    <a href="daftar_antrian.html" class="nav-item"><span>ğŸ«</span>Antrian</a>
  </footer>
</div>

<script>
const USER_TGL_MULAI_SEWA = localStorage.getItem('maka_user_start') || '2025-09-18';
const USER_OPSI_DP = localStorage.getItem('maka_user_dp') || '355';
const MAKA_PLUS_RATE = 10000;
const ADMIN_FINANCE = JSON.parse(localStorage.getItem('maka_finance_settings')) || { hwb_rate:80000, cdp_rate:70000 };
const USER_TARIF_HARIAN = ADMIN_FINANCE.hwb_rate;
const USER_TARIF_CDP = ADMIN_FINANCE.cdp_rate;
const DP_START = new Date(new Date(USER_TGL_MULAI_SEWA).getFullYear(), new Date(USER_TGL_MULAI_SEWA).getMonth()+1,1);
const DP_END = new Date(DP_START.getFullYear(), DP_START.getMonth()+3,1);
function getStatus(d){const day=d.getDate(); if(day===31) return 'HLB'; if(USER_OPSI_DP==='355'){ if(d>=DP_START && d<DP_END && (day===14||day===28)) return 'CDP'; if(d>=DP_END && (day===14||day===28)) return 'HLB'; } else if(USER_OPSI_DP==='775'){ if(day===14||day===28) return 'HLB'; } return 'HWB'; }
function makaPlusCharge(today){ const mp=JSON.parse(localStorage.getItem('maka_plus_status'))||{active:false}; if(!mp.active) return 0; const start=new Date(mp.activated_at); start.setDate(start.getDate()+1); if(today<start) return 0; const days=Math.floor((today-start)/86400000)+1; return days*MAKA_PLUS_RATE; }
function calc(){ const now=new Date(); now.setHours(0,0,0,0); const start=new Date(USER_TGL_MULAI_SEWA); start.setHours(0,0,0,0); let total=0, days=0; const paid = JSON.parse(localStorage.getItem('maka_payments'))||{}; let cur=new Date(start); while(cur<=now){ const k=`${cur.getFullYear()}-${cur.getMonth()+1}-${cur.getDate()}`; if(!paid[k]){ const s=getStatus(cur); if(s==='HWB'){ total+=USER_TARIF_HARIAN; days++; } if(s==='CDP'){ total+=USER_TARIF_CDP; days++; } } cur.setDate(cur.getDate()+1); } total += makaPlusCharge(now); return {total, days}; }
document.addEventListener('DOMContentLoaded', ()=>{ let user=JSON.parse(localStorage.getItem('maka_user_data'))||{name:'M Rizky Firdaus', plate:'B 4248 SWF'}; document.getElementById('user-name-display').textContent=`Halo, ${user.name}`; document.getElementById('user-plate-display').textContent=user.plate; const r=calc(); document.getElementById('hero-tunggakan-nominal').textContent=`Rp ${r.total.toLocaleString('id-ID')}`; document.getElementById('hero-tunggakan-days').textContent=`${r.days} Hari`; const mp = JSON.parse(localStorage.getItem('maka_plus_status'))||{active:false}; const mpCard = document.getElementById('maka-plus-card'); if(mp.active) mpCard.querySelector('p').textContent = `MAKA+ Aktif (mulai ${new Date(mp.activated_at).toLocaleDateString()})`; });
</script>
</body>
</html>
